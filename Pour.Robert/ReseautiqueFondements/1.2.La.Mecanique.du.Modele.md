### 1.2 La Mécanique du Modèle : L'Encapsulation

Le modèle OSI n'est pas statique ; c'est une chaîne de montage. Pour qu'une donnée voyage d'un ordinateur A vers un ordinateur B, elle doit subir une transformation appelée **encapsulation**.

Imaginez que vous envoyez une lettre fragile par la poste : vous la mettez dans une enveloppe, puis dans une boîte, puis dans un camion. Sur le réseau, c'est la même chose : chaque couche ajoute sa propre "enveloppe" (en-tête ou *header*) autour des données reçues de la couche supérieure.



#### Étude de cas 1 : Le parcours d'un Email

Prenons l'exemple d'un utilisateur, Alice, qui envoie un email à Bob. Voici ce qui se passe techniquement, couche par couche, lors de l'envoi (Descente de la couche 7 vers 1) :

1.  **Couches Hautes (Application - L7) : La Donnée**
    * **Action :** Alice clique sur "Envoyer" dans son logiciel de messagerie (Outlook, Thunderbird).
    * **Donnée :** Le contenu de l'email ("Salut Bob !") est formaté par le protocole **SMTP**.
    * **Analogie :** Alice écrit sa lettre.

2.  **Couche Transport (L4) : Le Segment**
    * **Action :** Le système d'exploitation reçoit la donnée et choisit la fiabilité (TCP). Il découpe les données si elles sont trop grosses.
    * **Encapsulation :** On ajoute un en-tête TCP contenant les **Ports** (Port source : aléatoire, Port destination : 25 pour SMTP).
    * **Analogie :** On met la lettre dans une enveloppe recommandée pour s'assurer qu'elle arrive (TCP). On écrit "Pour le service courrier" (Port).

3.  **Couche Réseau (L3) : Le Paquet**
    * **Action :** On doit déterminer qui est le destinataire final sur le réseau mondial.
    * **Encapsulation :** On ajoute un en-tête IP contenant les **Adresses IP** (IP Source : celle d'Alice, IP Destination : celle du serveur mail).
    * **Analogie :** On écrit l'adresse postale complète sur l'enveloppe (Pays, Ville, Rue).

4.  **Couche Liaison (L2) : La Trame**
    * **Action :** Le paquet doit être remis au prochain appareil *physique* directement connecté (ex: la box internet ou le routeur de l'entreprise), et non directement au serveur final qui est à l'autre bout du monde.
    * **Encapsulation :** On ajoute un en-tête Ethernet contenant les **Adresses MAC** (MAC Source : PC d'Alice, MAC Destination : Routeur local). On ajoute aussi un "pied de page" (FCS) pour vérifier l'intégrité.
    * **Analogie :** Le facteur met l'enveloppe dans sa sacoche pour l'emmener au centre de tri local.

5.  **Couche Physique (L1) : Les Bits**
    * **Action :** La trame numérique (suite de 0 et de 1) est convertie en signaux physiques.
    * **Transmission :** Si c'est du Wi-Fi, ce sont des ondes radio. Si c'est un câble Ethernet, ce sont des impulsions électriques.
    * **Analogie :** Le camion de la poste roule sur l'autoroute.

#### La Décapsulation (Réception)

Lorsque le serveur de messagerie reçoit le signal, il effectue le chemin inverse (de 1 vers 7) :
1.  Il lit les bits (**L1**).
2.  Il vérifie l'adresse MAC et retire l'enveloppe Ethernet (**L2**).
3.  Il vérifie l'adresse IP et retire l'enveloppe IP (**L3**).
4.  Il vérifie le port, rassemble les segments et retire l'enveloppe TCP (**L4**).
5.  Le logiciel serveur lit enfin le message "Salut Bob !" (**L7**).

#### Étude de cas 2 : Réception d'un appel VoIP (SIP)

Analysons maintenant ce qui se passe lorsque le téléphone IP de Bob commence à sonner. Ici, le processus est une **décapsulation** (remontée de la couche 1 vers 7) et la contrainte principale est la vitesse.

1.  **Couche Physique (L1) : L'arrivée du signal**
    * **Réception :** Le câble réseau connecté au téléphone reçoit une série d'impulsions électriques.
    * **Action :** La carte réseau convertit ces signaux en bits (0 et 1).

2.  **Couche Liaison (L2) : Vérification locale**
    * **Lecture :** Le téléphone lit l'en-tête **Ethernet**.
    * **Vérification :** "Est-ce que l'adresse MAC de destination est la mienne ?" (Oui).
    * **Action :** Il retire l'enveloppe Ethernet et passe le reste à la couche supérieure. Si l'adresse MAC ne correspondait pas, le paquet aurait été jeté immédiatement (sauf en mode promiscuous).

3.  **Couche Réseau (L3) : Vérification finale**
    * **Lecture :** Le téléphone lit l'en-tête **IP**.
    * **Vérification :** "Est-ce que l'adresse IP de destination est bien 192.168.1.50 (mon IP) ?"
    * **Action :** Il retire l'enveloppe IP.

4.  **Couche Transport (L4) : Le tri du courrier**
    * **Lecture :** Le téléphone lit l'en-tête **UDP** (souvent utilisé pour SIP car plus rapide que TCP).
    * **Vérification :** "Quel est le port de destination ?" Il lit le port **5060**.
    * **Action :** Le système sait que le port 5060 correspond au service de téléphonie (processus SIP). Il dirige les données vers cette application spécifique.

5.  **Couche Application (L7) : L'intelligence**
    * **Lecture :** Le logiciel de téléphonie décode le message SIP. C'est une méthode `INVITE`.
    * **Contenu :** "Alice (101) veut parler à Bob (102)".
    * **Réaction visible :** Le téléphone affiche "Appel d'Alice" sur l'écran et active la sonnerie.
    * **Réaction réseau :** Simultanément, le téléphone génère une réponse `180 Ringing` qui redescend toutes les couches (7 vers 1) pour avertir Alice que "ça sonne".

> **Note importante :** Une fois que Bob décroche, la signalisation SIP laisse place au protocole **RTP** (Real-time Transport Protocol) pour transporter la voix elle-même, souvent sur une plage de ports UDP dynamique (ex: 16384-32767).
